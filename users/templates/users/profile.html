<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'users/profile.css' %}">
</head>
<script src="{% static 'users/js/follow.js' %}"></script>
<body>
    <div class="container">
        <h1>Welcome, {{ user.name }}</h1>

        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                    <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
            <script>
                {% for message in messages %}
                    {% if "Profile updated successfully!" in message.message %}
                        setTimeout(function() {
                            window.location.href = "{% url 'post-list' %}";
                        }, 1000);
                    {% endif %}
                {% endfor %}
            </script>
        {% endif %}

        <!-- Profile Picture Section -->
        <div class="profile-pic">
            {% if user_profile.profile_pic %}
                <img src="{{ user_profile.profile_pic.url }}" alt="Profile Picture">
            {% else %}
                <img src="{% static 'users/images/default-profile.png' %}" alt="Default Profile">
            {% endif %}
        </div>
        
        <!-- Followers, Following, Notifications -->
        <p>
            <a href="{% url 'followers-list' user.id %}">Followers: {{ user.followers.count }}</a> |
            <a href="{% url 'following-list' user.id %}">Following: {{ user.following.count }}</a> |
        <!-- Follow Button -->
        {% if request.user != user_profile %}
        <form id="followForm" action="{% url 'follow-user' user_profile.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" id="followButton">
                {% if is_following %}
                    Unfollow
                {% else %}
                    Follow
                {% endif %}
            </button>
        </form>
        <p><a href="{% url 'send-message' user_profile.id %}">Send Message</a></p>
        {% endif %}

        <!-- Profile Edit Form -->
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" name="redirect" value="create">Save & Create Post</button>
            <button type="submit" name="redirect" value="list">Save & View Posts</button>
        </form>
        <!-- Share Profile Section -->
<div class="share-profile">
    <h3>Share Profile</h3>

    <!-- Profile Link -->
    <input type="text" id="profileLink" value="{{ request.build_absolute_uri }}" readonly>
    <button onclick="copyLink()">
        <i class="fas fa-copy"></i> Copy Link
    </button>

    <!-- Share Buttons -->
    <div class="share-icons">
        <a href="https://wa.me/?text={{ request.build_absolute_uri }}" target="_blank" title="WhatsApp">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="https://t.me/share/url?url={{ request.build_absolute_uri }}" target="_blank" title="Telegram">
            <i class="fab fa-telegram-plane"></i>
        </a>
        <a href="mailto:?subject=Check out this profile&body={{ request.build_absolute_uri }}" title="Email">
            <i class="fas fa-envelope"></i>
        </a>
    </div>

    <!-- QR Code -->
    <div class="qr-section">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ request.build_absolute_uri }}" alt="QR Code">
        <p>Scan to view profile</p>
    </div>
</div>

        <!-- Extra Buttons -->
        <p><a href="{% url 'my-posts' %}" class="btn">My Posts</a></p>
        <p><a href="{% url 'logout' %}">Logout</a></p>
    </div>
    <script>
        function copyLink() {
            const link = document.getElementById("profileLink");
            link.select();
            link.setSelectionRange(0, 99999);
            document.execCommand("copy");
            alert("Profile link copied!");
        }
        </script>
        <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>

</body>
</html>
